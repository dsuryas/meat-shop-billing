import{j as e,I as w,r as P,i as re,k as te,l as se,C as B,b as E,c as A,d as L,e as M,A as G,a as U,B as W}from"./index-BIXGV2mp.js";import{P as n}from"./index-w-eSnYTo.js";const H=(r,s,c,u,a)=>{if(r.type==="base"){if(r.id==="countryChicken"){if(u==="retail")switch(c){case"live":return s.productPrices.countryChicken||0;case"withSkin":return s.productPrices.countryChickenWithSkin||s.productPrices.countryChicken||0;case"meat":return s.productPrices.countryChickenMeat||s.productPrices.countryChicken||0;default:return s.productPrices.countryChicken||0}else if(u==="wholesale")return s.paperRate;return s.productPrices.countryChicken||0}switch(r.id){case"retail":switch(c){case"live":return s.productPrices.liveChicken;case"withSkin":return s.productPrices.chickenWithSkin;case"meat":return s.shopRate;default:return 0}case"wholesale":switch(c){case"live":return s.paperRate;case"meat":return s.shopRate;default:return s.paperRate}default:return 0}}else{const i=products.find(m=>m.id===r.id);return i?i.wholesalePrice:0}},_=(r,s,c,u,a,i,m,N)=>{const t=H(a,i,c,u);let h=t;(a.id==="wholesale"||a.id==="countryChicken"&&u==="wholesale")&&Number(N)>0&&(h=Number(t)+Number(N));const b=Math.max(0,Number(h)-Number(s||0));let p=Number(r);return(a.id==="retail"||a.id==="countryChicken"&&u==="retail")&&c==="meat"&&(p=Math.round(p/m*100)/100),(p*b).toFixed(2)},ie=(r,s,c,u,a,i)=>{let m=a;return(c.id==="wholesale"||c.id==="countryChicken"&&u==="wholesale")&&Number(i)>0&&(m=Number(a)+Number(i)),((s*m-r)/s).toFixed(2)},J=(r,s)=>!r||Number(r)<=0||!s||Number(s)<=0?"0.00":(Number(r)/Number(s)).toFixed(2),D=(r,s)=>!r||Number(r)<=0||!s||Number(s)<=0?"0.00":(Number(r)/Number(s)).toFixed(2),I=(r,s,c,u)=>!r||Number(r)<=0?"0.00":((Number(s)+Number(c||0)-Number(u||0))*Number(r)).toFixed(2),$=(r,s,c,u)=>!r||Number(r)<=0?"0.00":((Number(s)+Number(c||0)-Number(u||0))*Number(r)).toFixed(2),Q=(r,s,c,u,a)=>{if(!r||Number(r)<=0||!s||Number(s)<=0)return"0.00";const i=Number(r)/Number(s),m=I(s,c,u,a);return(i*Number(m)).toFixed(2)},X=(r,s,c,u,a)=>{if(!r||Number(r)<=0||!s||Number(s)<=0)return"0.00";const i=Number(r)/Number(s),m=$(s,c,u,a);return(i*Number(m)).toFixed(2)},ne=(r,s,c,u,a)=>(r.id==="wholesale"||r.id==="countryChicken"&&s==="wholesale")&&c&&Number(u)>0&&Number(a)>0,ce=r=>r.id!=="countryChicken",ae=r=>r.id==="countryChicken",oe=(r,s)=>r.id==="wholesale"||r.id==="countryChicken"&&s==="wholesale",le=({billData:r,basePrice:s})=>e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-3",children:"Conversion Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border-r border-blue-200 pr-4",children:[e.jsx("h4",{className:"font-medium text-blue-700 mb-2",children:"With Skin"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-blue-100",children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Conversion Rate:"}),e.jsx("td",{className:"py-1 font-medium text-right",children:r.withSkinRate})]}),e.jsxs("tr",{className:"border-b border-blue-100",children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Price Per Kg:"}),e.jsxs("td",{className:"py-1 font-medium text-right",children:["₹",I(r.withSkinRate,s,r.customerSellingPrice,r.discountPerKg)]})]}),e.jsxs("tr",{className:"border-b border-blue-100",children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Converted Weight:"}),e.jsxs("td",{className:"py-1 font-medium text-right",children:[J(r.weight,r.withSkinRate)," kg"]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Total Price:"}),e.jsxs("td",{className:"py-1 font-bold text-right",children:["₹",Q(r.weight,r.withSkinRate,s,r.customerSellingPrice,r.discountPerKg)]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-700 mb-2",children:"Without Skin"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-blue-100",children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Conversion Rate:"}),e.jsx("td",{className:"py-1 font-medium text-right",children:r.withoutSkinRate})]}),e.jsxs("tr",{className:"border-b border-blue-100",children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Price Per Kg:"}),e.jsxs("td",{className:"py-1 font-medium text-right",children:["₹",$(r.withoutSkinRate,s,r.customerSellingPrice,r.discountPerKg)]})]}),e.jsxs("tr",{className:"border-b border-blue-100",children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Converted Weight:"}),e.jsxs("td",{className:"py-1 font-medium text-right",children:[D(r.weight,r.withoutSkinRate)," kg"]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 text-blue-600 italic",children:"Total Price:"}),e.jsxs("td",{className:"py-1 font-bold text-right",children:["₹",X(r.weight,r.withoutSkinRate,s,r.customerSellingPrice,r.discountPerKg)]})]})]})})]})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-blue-200 text-xs text-blue-600",children:[e.jsx("h4",{className:"text-sm text-blue-700 mb-2",children:"Without Conversion"}),e.jsxs("div",{children:["Base Rate: ₹",s,"/kg + Customer Price: ₹",r.customerSellingPrice,"/kg - Discount: ₹",r.discountPerKg||0,"/kg"]}),e.jsxs("div",{children:["Final Customer Price: ₹",(Number(s)+Number(r.customerSellingPrice)-Number(r.discountPerKg||0)).toFixed(2),"/kg"]})]})]}),ue=({billingOption:r,rates:s,saleType:c,productType:u,onChange:a})=>{const i=()=>r.id==="countryChicken"?c==="retail"?e.jsxs(e.Fragment,{children:[e.jsxs("option",{value:"live",children:["Live Country Chicken (₹",s.productPrices.countryChicken||0,"/kg)"]}),e.jsxs("option",{value:"withSkin",children:["Country Chicken with Skin (₹",s.productPrices.countryChickenWithSkin||s.productPrices.countryChicken||0,"/kg)"]}),e.jsxs("option",{value:"meat",children:["Country Chicken Meat (₹",s.productPrices.countryChickenMeat||s.productPrices.countryChicken||0,"/kg)"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("option",{value:"live",children:["Live Country Chicken (₹",s.paperRate,"/kg)"]}),e.jsxs("option",{value:"meat",children:["Country Chicken Meat (₹",s.shopRate,"/kg)"]})]}):r.id==="retail"?e.jsxs(e.Fragment,{children:[e.jsxs("option",{value:"live",children:["Live Chicken (₹",s.productPrices.liveChicken,"/kg)"]}),e.jsxs("option",{value:"withSkin",children:["With Skin (₹",s.productPrices.chickenWithSkin,"/kg)"]}),e.jsxs("option",{value:"meat",children:["Meat (₹",s.shopRate,"/kg)"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("option",{value:"live",children:["Live Chicken (₹",s.paperRate,"/kg)"]}),e.jsxs("option",{value:"meat",children:["Chopped Chicken (₹",s.shopRate,"/kg)"]})]});return e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Type *"}),e.jsx("select",{value:u,onChange:m=>a(m.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md",children:i()})]})},Y=({customerName:r,customerPhone:s,showCustomerDropdown:c,filteredCustomers:u,handleInputChange:a,handleSelectCustomer:i,shouldShowWholesaleOptions:m,saleType:N,billingOption:t})=>e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium",children:"Customer Name *"}),e.jsx(w,{placeholder:"Enter or search name",value:r,onChange:h=>a("customerName",h.target.value),className:"mt-1"}),m(t,N)&&c&&e.jsx("div",{className:"absolute z-10 w-full bg-white mt-1 border rounded-md shadow-lg max-h-60 overflow-y-auto",children:u.map(h=>e.jsxs("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>i(h),children:[e.jsx("div",{className:"font-medium",children:h.name}),e.jsx("div",{className:"text-sm text-gray-500",children:h.phone})]},h.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Phone Number *"}),e.jsx(w,{placeholder:"Enter phone",value:s,onChange:h=>a("customerPhone",h.target.value),className:"mt-1"})]})]});Y.propTypes={customerName:n.string.isRequired,customerPhone:n.string.isRequired,showCustomerDropdown:n.bool.isRequired,filteredCustomers:n.array.isRequired,handleInputChange:n.func.isRequired,handleSelectCustomer:n.func.isRequired,shouldShowWholesaleOptions:n.func.isRequired,saleType:n.string.isRequired,billingOption:n.object.isRequired};const Z=({billingOption:r,rates:s,saleType:c,chickenType:u,customerSellingPrice:a,handleInputChange:i,shouldShowChickenTypeSelector:m,shouldShowSaleTypeSelector:N,shouldShowWholesaleOptions:t,productType:h,conversionFactors:b,ProductTypeSelector:p})=>e.jsxs(e.Fragment,{children:[m(r)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Chicken Type *"}),e.jsxs("select",{value:u,onChange:g=>i("chickenType",g.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"broiler",children:"Broiler Chicken"}),e.jsx("option",{value:"country",children:"Country Chicken"})]}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("div",{className:"text-xs text-gray-500 mr-2",children:"Conversion Factor:"}),e.jsx("div",{className:"text-xs font-medium",children:u==="country"?b.countryChicken:b.broiler})]})]}),N(r)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Sale Type *"}),e.jsxs("select",{value:c,onChange:g=>i("saleType",g.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:c==="retail"?"Retail pricing for individual customers":"Wholesale pricing for bulk orders"})]}),t(r,c)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Customer Price (₹/kg)"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Enter additional price per kg",value:a,onChange:g=>i("customerSellingPrice",g.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Additional per kg price on top of the paper rate"})]}),e.jsx(p,{billingOption:r,rates:s,saleType:c,productType:h,onChange:g=>i("productType",g)})]});Z.propTypes={billingOption:n.object.isRequired,rates:n.object.isRequired,saleType:n.string.isRequired,chickenType:n.string.isRequired,customerSellingPrice:n.string.isRequired,handleInputChange:n.func.isRequired,shouldShowChickenTypeSelector:n.func.isRequired,shouldShowSaleTypeSelector:n.func.isRequired,shouldShowWholesaleOptions:n.func.isRequired,productType:n.string.isRequired,conversionFactors:n.object.isRequired,ProductTypeSelector:n.elementType.isRequired};const O=({weight:r,numberOfBirds:s,discountPerKg:c,price:u,handleInputChange:a,calculateDiscountFromPrice:i,billingOption:m,saleType:N,currentBasePrice:t,customerSellingPrice:h,CONVERSION_FACTOR:b})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium",children:["Live weight (kg) *",e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Meat weight: ",(Number(r||0)/b).toFixed(2)," kg)"]})]}),e.jsx(w,{type:"number",step:"0.01",placeholder:"Enter weight",value:r,onChange:p=>a("weight",p.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Number of Birds *"}),e.jsx(w,{type:"number",placeholder:"Enter count",value:s,onChange:p=>a("numberOfBirds",p.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Discount (₹/kg)"}),e.jsx(w,{type:"number",step:"0.01",placeholder:"Enter discount",value:c,onChange:p=>a("discountPerKg",p.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Price (₹)"}),e.jsx(w,{type:"number",step:"0.01",placeholder:"Enter price",value:u,onChange:p=>{const g=p.target.value,j=Number(r);if(j>0){const x=i(g,j,m,N,t,h);a("discountPerKg",x)}a("price",g)},className:"mt-1"})]}),c&&r&&e.jsxs("div",{className:"col-span-4 text-sm text-gray-500",children:["Rate after discount: ₹",(Number(t)+Number(h||0)-Number(c||0)).toFixed(2),"/kg"]})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Current Conversion Factor: ",b]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",r?`${Number(r).toFixed(2)}kg live → ${(Number(r)/b).toFixed(2)}kg meat`:"Live to Meat Weight",")"]})]})})]});O.propTypes={weight:n.string.isRequired,numberOfBirds:n.string.isRequired,discountPerKg:n.string.isRequired,price:n.string.isRequired,handleInputChange:n.func.isRequired,calculateDiscountFromPrice:n.func.isRequired,billingOption:n.object.isRequired,saleType:n.string.isRequired,currentBasePrice:n.oneOfType([n.string,n.number]).isRequired,customerSellingPrice:n.string.isRequired,CONVERSION_FACTOR:n.number.isRequired};const ee=({paymentType:r,amountPaid:s,balanceAmount:c,handleInputChange:u})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Payment Type *"}),e.jsxs("select",{value:r,onChange:a=>u("paymentType",a.target.value),className:"w-full mt-1 px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"partial",children:"Partial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount Paid (₹) *"}),e.jsx(w,{type:"number",step:"0.01",placeholder:"Enter amount",value:s,onChange:a=>u("amountPaid",a.target.value),className:"mt-1",readOnly:r!=="partial"})]})]}),r==="partial"&&Number(c)>0&&e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-700",children:["Balance Amount: ₹",c]})})]});ee.propTypes={paymentType:n.string.isRequired,amountPaid:n.string.isRequired,balanceAmount:n.string.isRequired,handleInputChange:n.func.isRequired};const de=(r,s,c,u,a)=>{const[i,m]=P.useState({customerName:"",customerPhone:"",category:r.type==="base"?r.id:"additional",productType:"live",weight:"",numberOfBirds:"",discountPerKg:"",price:"",paymentType:"cash",amountPaid:"",balanceAmount:"0",selectedCustomer:null,customerSellingPrice:"0",withSkinRate:"0",withoutSkinRate:"0",chickenType:r.id==="countryChicken"?"country":"broiler",saleType:r.id==="countryChicken"?"retail":r.id}),[N,t]=P.useState(""),[h,b]=P.useState([]),[p,g]=P.useState([]),[j,x]=P.useState(!1),[S,R]=P.useState({broiler:1.45,countryChicken:1.65}),[f,F]=P.useState(!0),[k,q]=P.useState(null),C=i.chickenType==="country"?S.countryChicken:S.broiler,T=H(r,s,i.productType,i.saleType,i.chickenType);return P.useEffect(()=>{(async()=>{try{F(!0),q(null),await re();const[l,d]=await Promise.all([te(),se()]);R({broiler:l,countryChicken:d}),console.log("Loaded conversion factors:",{broiler:l,country:d})}catch(l){console.error("Error loading conversion factors:",l),q(l),R({broiler:1.45,countryChicken:1.65})}finally{F(!1)}})()},[]),P.useEffect(()=>{(async()=>{try{u&&m(u);const l=localStorage.getItem("meatShop_regularCustomers");if(l){const d=JSON.parse(l);b(d),g(d)}}catch(l){console.error("Error loading initial data:",l)}})()},[u]),P.useEffect(()=>{if(i.customerName.trim().length>0){const o=h.filter(l=>l.name.toLowerCase().includes(i.customerName.toLowerCase())||l.phone.includes(i.customerName));g(o),x(o.length>0)}else x(!1)},[i.customerName,h]),{billData:i,message:N,regularCustomers:h,filteredCustomers:p,showCustomerDropdown:j,conversionFactors:S,CONVERSION_FACTOR:C,currentBasePrice:T,isLoadingFactors:f,factorsError:k,handleInputChange:async(o,l)=>{m(d=>{const y={...d,[o]:l};return o==="saleType"&&l==="retail"&&d.saleType==="wholesale"&&(y.selectedCustomer=null,y.customerSellingPrice="0",y.withSkinRate="0",y.withoutSkinRate="0"),y}),!f&&(o==="weight"||o==="discountPerKg"||o==="productType"||o==="customerSellingPrice"||o==="chickenType"||o==="saleType")&&setTimeout(()=>{m(d=>{const y=_(o==="weight"?l:d.weight,o==="discountPerKg"?l:d.discountPerKg,o==="productType"?l:d.productType,o==="saleType"?l:d.saleType,r,s,C,o==="customerSellingPrice"?l:d.customerSellingPrice),v={...d,price:y};return v.paymentType==="partial"?(v.amountPaid="",v.balanceAmount=y):(v.amountPaid=y,v.balanceAmount="0"),v})},0),o==="paymentType"&&m(d=>({...d,amountPaid:l==="partial"?"":d.price,balanceAmount:l==="partial"?d.price:"0"})),o==="amountPaid"&&m(d=>({...d,balanceAmount:(Number(d.price)-Number(l)).toFixed(2)}))},handleSelectCustomer:async o=>{if(m(l=>({...l,customerName:o.name,customerPhone:o.phone,selectedCustomer:o,withSkinRate:o.withSkinRate,withoutSkinRate:o.withoutSkinRate,customerSellingPrice:o.sellingPrice})),x(!1),!f){const l=_(i.weight,i.discountPerKg,i.productType,i.saleType,r,s,C,o.sellingPrice);m(d=>({...d,customerName:o.name,customerPhone:o.phone,selectedCustomer:o,withSkinRate:o.withSkinRate,withoutSkinRate:o.withoutSkinRate,customerSellingPrice:o.sellingPrice,price:l,amountPaid:d.paymentType==="partial"?d.amountPaid:l,balanceAmount:d.paymentType==="partial"?l:"0"}))}},handleSubmit:async o=>{if(o.preventDefault(),f){t("Please wait for conversion factors to load...");return}if(!i.customerName||!i.customerPhone||!i.weight||!i.price||!i.amountPaid||!i.numberOfBirds){t("Please fill all required fields");return}if(Number(i.weight)<=0){t("Weight must be greater than 0");return}if(Number(i.amountPaid)<0){t("Amount paid cannot be negative");return}if(i.paymentType!=="partial"&&Number(i.amountPaid)!==Number(i.price)){t("Amount paid must equal total price for full payment");return}if(i.paymentType==="partial"&&Number(i.amountPaid)>=Number(i.price)){t("Partial payment must be less than total price");return}try{const l={...i,basePrice:T,finalPricePerKg:Number(T)+Number(i.customerSellingPrice||0)-Number(i.discountPerKg||0),productName:r.name,weightType:a,rawWeight:Number(i.weight),inventoryWeight:a==="meat"?Number(i.weight)/C:Number(i.weight),meatWeight:Number(i.weight)/C,usedConversionFactor:C,timestamp:new Date().toISOString()};await c(l)}catch(l){console.error("Error generating bill:",l),t("Error generating bill. Please try again.")}},setMessage:t,shouldShowConversions:ne,shouldShowChickenTypeSelector:ce,shouldShowSaleTypeSelector:ae,shouldShowWholesaleOptions:oe,calculateDiscountFromPrice:ie}},me=({rates:r,billingOption:s,onBillGenerate:c,onCancel:u,editData:a,weightType:i,currentStock:m,currentCountryStock:N})=>{const{billData:t,message:h,filteredCustomers:b,showCustomerDropdown:p,conversionFactors:g,CONVERSION_FACTOR:j,currentBasePrice:x,isLoadingFactors:S,factorsError:R,handleInputChange:f,handleSelectCustomer:F,setMessage:k,shouldShowConversions:q,shouldShowChickenTypeSelector:C,shouldShowSaleTypeSelector:T,shouldShowWholesaleOptions:K,calculateDiscountFromPrice:V}=de(s,r,c,a,i);if(S)return e.jsxs(B,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Loading Billing Form..."}),e.jsx(L,{children:"Please wait while we load conversion factors"})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading conversion factors..."})]})})]});if(R)return e.jsxs(B,{children:[e.jsxs(E,{children:[e.jsx(A,{children:"Error Loading Billing Form"}),e.jsx(L,{children:"There was an issue loading conversion factors"})]}),e.jsxs(M,{children:[e.jsx(G,{className:"mb-4",children:e.jsxs(U,{children:["Warning: Using default conversion factors. Some calculations may not be accurate.",e.jsx("br",{}),"Error: ",R.message]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(W,{onClick:()=>window.location.reload(),className:"flex-1",children:"Retry"}),e.jsx(W,{variant:"outline",onClick:u,className:"flex-1",children:"Cancel"})]})]})]});const z=async o=>{if(o.preventDefault(),!t.customerName||!t.customerPhone||!t.weight||!t.price||!t.amountPaid||!t.numberOfBirds){k("Please fill all required fields");return}if(Number(t.weight)<=0){k("Weight must be greater than 0");return}let l=Number(t.weight);i==="meat"&&(l=l/j);const d=t.chickenType==="country"?N:m;if(l>Number(d)){k(`Weight cannot exceed current stock (${d}kg ${i} weight)`);return}if(Number(t.amountPaid)<0){k("Amount paid cannot be negative");return}if(t.paymentType!=="partial"&&Number(t.amountPaid)!==Number(t.price)){k("Amount paid must equal total price for full payment");return}if(t.paymentType==="partial"&&Number(t.amountPaid)>=Number(t.price)){k("Partial payment must be less than total price");return}try{const y={...t,basePrice:x,finalPricePerKg:Number(x)+Number(t.customerSellingPrice||0)-Number(t.discountPerKg||0),productName:s.name,weightType:i,rawWeight:Number(t.weight),inventoryWeight:i==="meat"?Number(t.weight)/j:Number(t.weight),meatWeight:Number(t.weight)/j,withSkinWeight:J(t.weight,t.withSkinRate),withoutSkinWeight:D(t.weight,t.withoutSkinRate),withSkinPrice:Q(t.weight,t.withSkinRate,x,t.customerSellingPrice,t.discountPerKg),withoutSkinPrice:X(t.weight,t.withoutSkinRate,x,t.customerSellingPrice,t.discountPerKg),withSkinPricePerKg:I(t.withSkinRate,x,t.customerSellingPrice,t.discountPerKg),withoutSkinPricePerKg:$(t.withoutSkinRate,x,t.customerSellingPrice,t.discountPerKg),usedConversionFactor:j,timestamp:new Date().toISOString()};await c(y)}catch(y){console.error("Error generating bill:",y),k("Error generating bill. Please try again.")}};return e.jsxs(B,{children:[e.jsxs(E,{children:[e.jsxs(A,{children:["Generate Bill - ",s.name]}),e.jsxs(L,{children:[K(s,t.saleType)?e.jsxs(e.Fragment,{children:["Paper Rate: ₹",x,"/kg",Number(t.customerSellingPrice)>0&&e.jsxs("span",{children:[" + Customer Price: ₹",t.customerSellingPrice,"/kg"]})]}):e.jsxs(e.Fragment,{children:["Base Rate: ₹",x,"/kg"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Conversion Factor: ",j," (",t.chickenType==="country"?"Country Chicken":"Broiler",")"]})]})]}),e.jsxs(M,{children:[e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsx(Y,{customerName:t.customerName,customerPhone:t.customerPhone,showCustomerDropdown:p,filteredCustomers:b,handleInputChange:f,handleSelectCustomer:F,shouldShowWholesaleOptions:K,saleType:t.saleType,billingOption:s}),e.jsx(Z,{billingOption:s,rates:r,saleType:t.saleType,chickenType:t.chickenType,customerSellingPrice:t.customerSellingPrice,handleInputChange:f,shouldShowChickenTypeSelector:C,shouldShowSaleTypeSelector:T,shouldShowWholesaleOptions:K,productType:t.productType,conversionFactors:g,ProductTypeSelector:ue}),e.jsx(O,{weight:t.weight,numberOfBirds:t.numberOfBirds,discountPerKg:t.discountPerKg,price:t.price,handleInputChange:f,calculateDiscountFromPrice:V,billingOption:s,saleType:t.saleType,currentBasePrice:x,customerSellingPrice:t.customerSellingPrice,CONVERSION_FACTOR:j}),q(s,t.saleType,t.selectedCustomer,t.withSkinRate,t.withoutSkinRate)&&e.jsx(le,{billData:t,basePrice:x}),e.jsx(ee,{paymentType:t.paymentType,amountPaid:t.amountPaid,balanceAmount:t.balanceAmount,handleInputChange:f}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsxs("div",{children:["Available Stock: ",t.chickenType==="country"?N:m,"kg (",i," weight)"]}),t.weight&&e.jsxs("div",{className:"mt-1",children:["Required Stock: ",i==="meat"?(Number(t.weight)/j).toFixed(3):t.weight,"kg"]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(W,{type:"submit",className:"flex-1",disabled:S,children:a?"Update Bill":"Generate Bill"}),e.jsx(W,{type:"button",variant:"outline",onClick:u,className:"flex-1",children:"Cancel"})]})]}),h&&e.jsx(G,{className:"mt-4",children:e.jsx(U,{children:h})})]})]})};me.propTypes={rates:n.object.isRequired,billingOption:n.object.isRequired,onBillGenerate:n.func.isRequired,onCancel:n.func.isRequired,editData:n.object,weightType:n.string.isRequired,currentStock:n.oneOfType([n.string,n.number]).isRequired,currentCountryStock:n.oneOfType([n.string,n.number]).isRequired};export{me as default};
