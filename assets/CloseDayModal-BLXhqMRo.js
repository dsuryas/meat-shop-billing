import{r,w as X,j as e,C as Z,b as ee,c as se,d as te,e as ae,I as x,A as ne,a as re,n as ie,B as M,M as B,t as oe}from"./index-BIXGV2mp.js";import{P as t}from"./index-w-eSnYTo.js";const le=({dailySetup:l,currentStock:E,expectedBirds:c,currentCountryStock:k,expectedCountryBirds:d,currentEarnings:p,estimatedEarnings:S,totalDiscounts:R,onClose:D,onConfirm:O})=>{var I;const[b,W]=r.useState(""),[m,P]=r.useState(""),[N,q]=r.useState(""),[u,_]=r.useState(""),[i,y]=r.useState([]),[G,V]=r.useState([]),[h,$]=r.useState(0),[L,H]=r.useState(""),[F,j]=r.useState("");r.useEffect(()=>{const s=X();if(V(s),s.length>0){const n=s.map(a=>({categoryId:a.id,categoryName:a.name,amount:""}));y(n)}else y([{categoryId:"generic",categoryName:"General Expense",amount:""}])},[]),r.useEffect(()=>{const s=i.reduce((n,a)=>n+(Number(a.amount)||0),0);$(s)},[i]);const w=(s,n)=>{const a=[...i];a[s]={...a[s],amount:n},y(a)},U=s=>{if(s.preventDefault(),!b||!m){j("Please enter both remaining broiler stock and birds");return}if(!N||!u){j("Please enter both remaining country chicken stock and birds");return}if(Number(b)<0||Number(m)<0||Number(N)<0||Number(u)<0){j("Stock and birds cannot be negative");return}for(const g of i)if(g.amount&&Number(g.amount)<0){j(`Expense amount for ${g.categoryName} cannot be negative`);return}const n=Number(E),a=Number(b);let o=n-a,Y=n>0?o/n*100:0;const f=Number(k),T=Number(N);let C=f-T,z=f>0?C/f*100:0,v=o;l.estimationMethod==="liveRate"?v=o/B:v=o*B;let J=C/oe;const K=i.filter(g=>Number(g.amount)>0),Q={date:new Date().toISOString(),expectedStock:n,actualStock:a,weightLoss:o.toFixed(2),weightLossPercentage:Y.toFixed(2),estimationMethod:l.estimationMethod,liveWeightLoss:l.estimationMethod==="liveRate"?o.toFixed(2):v.toFixed(2),meatWeightLoss:l.estimationMethod==="liveRate"?v.toFixed(2):o.toFixed(2),expectedCountryStock:f,actualCountryStock:T,countryWeightLoss:C.toFixed(2),countryWeightLossPercentage:z.toFixed(2),countryMeatWeightLoss:J.toFixed(2),expectedBirds:c,actualBirds:Number(m),birdLoss:c-Number(m),birdLossPercentage:c>0?((c-Number(m))/c*100).toFixed(2):"0.00",expectedCountryBirds:d,actualCountryBirds:Number(u),countryBirdLoss:d-Number(u),countryBirdLossPercentage:d>0?((d-Number(u))/d*100).toFixed(2):"0.00",dailySetupId:l.id||Date.now(),estimatedEarnings:S,actualEarnings:p,totalDiscounts:R,expenses:h,expenseItems:K,expenseNotes:L.trim(),netEarnings:p-h};O(Q)},A=()=>l.estimationMethod==="liveRate"?"Live weight":"Meat weight";return e.jsxs(Z,{className:"max-h-[90vh] flex flex-col",children:[e.jsxs(ee,{className:"flex-shrink-0",children:[e.jsx(se,{children:"Close Day"}),e.jsx(te,{children:"Enter final stock details for today"})]}),e.jsx(ae,{className:"overflow-y-auto pb-0",children:e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg space-y-2",children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Expected Remaining Broiler Stock"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:[E,"kg ",e.jsxs("span",{className:"text-sm",children:["(",A(),")"]})]}),e.jsxs("div",{className:"text-sm text-blue-600",children:["Expected Birds: ",c]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium",children:["Actual Remaining Broiler Stock (",A(),") *"]}),e.jsx(x,{type:"number",step:"0.01",value:b,onChange:s=>W(s.target.value),className:"mt-1",placeholder:"Enter actual remaining broiler stock"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Remaining Broiler Birds *"}),e.jsx(x,{type:"number",value:m,onChange:s=>P(s.target.value),className:"mt-1",placeholder:"Enter number of remaining broiler birds"})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg space-y-2",children:[e.jsx("h3",{className:"font-semibold text-green-800",children:"Expected Remaining Country Chicken Stock"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[k,"kg ",e.jsx("span",{className:"text-sm",children:"(Live weight)"})]}),e.jsxs("div",{className:"text-sm text-green-600",children:["Expected Birds: ",d]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Actual Remaining Country Chicken Stock (Live weight) *"}),e.jsx(x,{type:"number",step:"0.01",value:N,onChange:s=>q(s.target.value),className:"mt-1",placeholder:"Enter actual remaining country chicken stock"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Remaining Country Chicken Birds *"}),e.jsx(x,{type:"number",value:u,onChange:s=>_(s.target.value),className:"mt-1",placeholder:"Enter number of remaining country chicken birds"})]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg space-y-2",children:[e.jsx("h3",{className:"font-semibold text-purple-800",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-purple-700",children:[e.jsxs("div",{children:["Estimated Earnings: ₹",S.toFixed(2)]}),e.jsxs("div",{children:["Actual Earnings: ₹",p.toFixed(2)]}),e.jsxs("div",{children:["Total Discounts: ₹",R.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Daily Expenses"}),G.length===0?e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-yellow-700",children:"No expense categories configured. Please add categories in the Expenses tab of the Admin Dashboard."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"General Expenses (₹)"}),e.jsx(x,{type:"number",step:"0.01",value:((I=i[0])==null?void 0:I.amount)||"",onChange:s=>w(0,s.target.value),className:"mt-1",placeholder:"Enter total expenses for the day"})]})]}):e.jsx("div",{className:"space-y-3",children:i.map((s,n)=>e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm font-medium",children:[s.categoryName," (₹)"]}),e.jsx(x,{type:"number",step:"0.01",value:s.amount,onChange:a=>w(n,a.target.value),className:"mt-1",placeholder:`Enter ${s.categoryName.toLowerCase()} expenses`})]})},s.categoryId))}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Expenses:"}),e.jsxs("span",{className:"font-bold",children:["₹",h.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Expense Notes"}),e.jsx("textarea",{value:L,onChange:s=>H(s.target.value),className:"mt-1 w-full px-3 py-2 border rounded-md h-20",placeholder:"Enter details of expenses (optional)"})]})]}),h>0&&e.jsxs("div",{className:"bg-rose-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-rose-800",children:"Net Earnings"}),e.jsxs("div",{className:"text-lg font-bold text-rose-700",children:["₹",(p-h).toFixed(2)]})]}),F&&e.jsx(ne,{children:e.jsx(re,{children:F})})]})}),e.jsxs(ie,{className:"flex justify-end space-x-4 flex-shrink-0 mt-4 border-t pt-4",children:[e.jsx(M,{variant:"outline",onClick:D,children:"Cancel"}),e.jsx(M,{onClick:U,children:"Confirm & Close Day"})]})]})};le.propTypes={dailySetup:t.object.isRequired,currentStock:t.oneOfType([t.string,t.number]).isRequired,expectedBirds:t.oneOfType([t.string,t.number]).isRequired,currentCountryStock:t.oneOfType([t.string,t.number]).isRequired,expectedCountryBirds:t.oneOfType([t.string,t.number]).isRequired,currentEarnings:t.number.isRequired,estimatedEarnings:t.number.isRequired,totalDiscounts:t.number.isRequired,onClose:t.func.isRequired,onConfirm:t.func.isRequired};export{le as default};
