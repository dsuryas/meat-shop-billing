import{r as y,j as e,C as f,b as F,c as P,e as v,h as S}from"./index-BIXGV2mp.js";import{P as u}from"./index-w-eSnYTo.js";const o=({title:x,value:g,colorScheme:s="blue"})=>e.jsx(f,{className:`bg-${s}-50`,children:e.jsxs(v,{className:"pt-4 pb-4",children:[e.jsx("div",{className:`text-sm text-${s}-600 mb-1`,children:x}),e.jsx("div",{className:`text-lg font-bold text-${s}-700`,children:g})]})});o.propTypes={title:u.string.isRequired,value:u.node.isRequired,colorScheme:u.string};const k=()=>{const[x,g]=y.useState({closings:[],isLoading:!0,error:null}),s=(t,r=0)=>t==null||t===""||isNaN(Number(t))?r:Number(t),N=t=>{try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}};y.useEffect(()=>{(async()=>{try{const r=await Promise.resolve(S());g({closings:Array.isArray(r)?r:[],isLoading:!1,error:null})}catch(r){console.error("Error loading stats data:",r),g(l=>({...l,isLoading:!1,error:"Failed to load statistics"}))}})()},[]);const w=()=>{const{closings:t}=x;if(!t||t.length===0)return{averages:null,extremes:null};try{const r=(a,c)=>a.reduce((m,p)=>m+c(p),0),l=(a,c)=>r(a,c)/a.length,b={weightLossPercent:l(t,a=>s(a.weightLossPercentage)),avgWeightLoss:l(t,a=>s(a.weightLoss)),avgEarnings:l(t,a=>s(a.netEarnings))},d=(a,c,m)=>a.length?Math[m](...a.map(p=>c(p))):0,E={highest:{lossPercent:d(t,a=>s(a.weightLossPercentage),"max"),weightLoss:d(t,a=>s(a.weightLoss),"max"),earnings:d(t,a=>s(a.netEarnings),"max")},lowest:{lossPercent:d(t,a=>s(a.weightLossPercentage),"min"),weightLoss:d(t,a=>s(a.weightLoss),"min"),earnings:d(t,a=>s(a.netEarnings),"min")}};return{averages:b,extremes:E}}catch(r){return console.error("Error calculating statistics:",r),{averages:null,extremes:null}}},{averages:n,extremes:i}=w(),{closings:h,isLoading:L,error:j}=x;return L?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading statistics..."}):j?e.jsx("div",{className:"bg-red-50 p-4 rounded-lg text-red-600",children:j}):!h||h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No historical data available yet."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(o,{title:"Average Weight Loss",value:`${n==null?void 0:n.avgWeightLoss.toFixed(2)}kg (${n==null?void 0:n.weightLossPercent.toFixed(2)}%)`,colorScheme:"blue"}),e.jsx(o,{title:"Highest Weight Loss",value:`${i==null?void 0:i.highest.weightLoss.toFixed(2)}kg (${i==null?void 0:i.highest.lossPercent.toFixed(2)}%)`,colorScheme:"amber"}),e.jsx(o,{title:"Lowest Weight Loss",value:`${i==null?void 0:i.lowest.weightLoss.toFixed(2)}kg (${i==null?void 0:i.lowest.lossPercent.toFixed(2)}%)`,colorScheme:"green"}),e.jsx(o,{title:"Average Earnings",value:`₹${n==null?void 0:n.avgEarnings.toFixed(2)}`,colorScheme:"purple"})]}),e.jsxs(f,{children:[e.jsx(F,{children:e.jsx(P,{children:"Daily Operations Statistics"})}),e.jsx(v,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Stock Info"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Weight Loss"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Birds"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Financial"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:N(t.date)}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsxs("div",{children:["Expected: ",s(t.expectedStock).toFixed(2),"kg"]}),e.jsxs("div",{children:["Actual: ",s(t.actualStock).toFixed(2),"kg"]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.estimationMethod==="liveRate"?"Live weight":"Meat weight"})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                          ${s(t.weightLoss)>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:[s(t.weightLoss).toFixed(2),"kg"]}),e.jsxs("span",{className:"ml-2",children:["(",s(t.weightLossPercentage).toFixed(2),"%)"]})]})}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsxs("div",{children:["Expected: ",s(t.expectedBirds)]}),e.jsxs("div",{children:["Actual: ",s(t.actualBirds)]}),e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                          ${s(t.birdLoss)>0?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"}`,children:["Loss: ",s(t.birdLoss)," (",s(t.birdLossPercentage).toFixed(2),"%)"]})})]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 text-sm",children:[e.jsxs("div",{children:["Est: ₹",s(t.estimatedEarnings).toFixed(2)]}),e.jsxs("div",{children:["Act: ₹",s(t.actualEarnings).toFixed(2)]}),e.jsxs("div",{children:["Disc: ₹",s(t.totalDiscounts).toFixed(2)]}),e.jsxs("div",{children:["Exp: ₹",s(t.expenses).toFixed(2)]})]}),e.jsxs("div",{className:"mt-1 text-green-600 font-medium border-t border-green-200 pt-1",children:["Net: ₹",s(t.netEarnings).toFixed(2)]})]})]},r))})]})})})]})]})};export{k as default};
